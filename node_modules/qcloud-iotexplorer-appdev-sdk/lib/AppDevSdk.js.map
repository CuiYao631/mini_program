{"version":3,"sources":["../src/AppDevSdk.ts"],"names":["event_emitter_for_miniprogram_1","tslib_1","__importDefault","require","modules_1","utils_1","utils","__importStar","constants","ReportLevel","INFO","WARN","ERROR","AppDevPlugin","install","sdk","exports","AppDevSdk","_super","_a","getAccessToken","_b","appKey","_c","apiPlatform","_d","apiRegionId","_e","debug","apiUrl","_f","wsConfig","_g","_h","autoReconnect","_j","disconnectWhenAppHide","_k","connectWhenAppShow","__rest","reporter","_l","plugins","_m","defaultUin","_o","enableAccessTokenCache","_this","call","this","isManuallyClose","_defaultFamilyIdPromise","_defaultUin","_apiUrl","_debug","logger","config","reporterInstance","noop","info","eventName","params","__assign","level","err","warn","error","ws","IotWebsocket","loginManager","LoginManager","_apiPlatform","_apiRegionId","on","EventTypes","LoginStateChange","isLogin","emit","WsError","_reconnectWs","code","reason","WsClose","_onWebsocketClose","pushEvent","_handlePushEvent","envDetect","isMiniProgram","wx","onAppHide","disconnect","onAppShow","connect","length","forEach","plugin","usePlugin","__extends","prototype","Object","defineProperty","userInfo","userId","nickName","init","options","reload","_initPromise","Promise","resolve","reject","__awaiter","login","sent","normalizeError","err_1","getDefaultFamilyId","requestApi","Offset","Limit","FamilyList","Total","Name","FamilyId","Data","err_2","sendWebsocketMessage","action","send","connectWebsocket","disconnectWebsocket","subscribeDevices","deviceList","map","item","DeviceId","filter","Boolean","err_3","Action","payload","doNotRetry","needLogin","doNotReport","opts","checkLogin","accessToken","uin","RegionId","AccessToken","Platform","requestTokenApi","url","err_4","isVerifyLoginError","reLogin","reLoginError_1","genVerifyLoginFailError","WsPush","Type","SubType","Time","Payload","updateTime","Date","getTime","JSON","parse","base64","decode","deviceData","method","deviceDataParams","type","state","reported","__values","keys","next","done","key","value","Value","lastUpdate","WsReport","deviceId","LastUpdate","WsControl","WsEventReport","WsActionPush","WsActionReport","WsDeviceBind","WsDeviceUnbind","DeviceStatus","WsStatusChange","deviceStatus","subType","WsSubDeviceBind","gatewayDeviceId","subDeviceList","WsSubDeviceChange","WsSubDeviceUnbind","delay","err_5","default"],"mappings":"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"}